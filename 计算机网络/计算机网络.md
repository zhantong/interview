# 计算机网络

## 计算机网络分层体系结构

![Computer Network Architecture][computer_network_architecture]

## 数据进入协议栈时的封装

![Data Packet in Protocol Stack][data_packet_in_protocol_stack]

## TCP传输过程

![Tcp Communication][tcp_communication]

## HTTP报文

### HTTP请求报文

![Http Request Message][http_request_message]

#### 方法（Method）

客户端希望服务器对资源执行的动作。是一个单独的词，如GET、HEAD或POST。

|    方法   |                 描述                | 是否包含主体 |
| :-----: | :-------------------------------: | :----: |
|   GET   |       请求获取Request-URL所标识的资源       |    否   |
|   POST  |    向Request-URL所标识的资源发送需要处理的数据    |    是   |
|   HEAD  |     只请求获取由Request-URL所标识的资源的首部    |    否   |
|   PUT   | 将请求的主体部分存储在服务器，并用Request-URL作为其标识 |    是   |
|  DELETE |      请求服务器删除Request-URL所标识的资源     |    否   |
|  TRACE  |      请求服务器回送收到的请求信息，主要用于测试或诊断     |    否   |
| OPTIONS |          请求服务器告知其支持的各种功能          |    否   |

#### 请求URL（Request-URL）

命名了所请求资源，或者URL路径组件的完整URL。

#### 版本（Version）

报文所使用的HTTP版本，格式为

```text
HTTP/<major>.<minor>
```

其中主要版本号（major）和次要版本号（minor）都是整数。

#### 首部（Header Field）

首部和方法配合工作，共同决定了客户端和服务器能做什么事情。

##### 通用首部

###### 通用信息首部

|         首部        |                                     描述                                     |
| :---------------: | :------------------------------------------------------------------------: |
|     Connection    |                          允许客户端和服务器指定与请求/响应连接有关的选项                          |
|        Date       |                           提供日期和时间标志，说明报文是什么时间创建的                           |
|    MIME-Version   |                               给出了发送端使用的MIME版本                              |
|      Trailer      | 如果报文采用了分块传输编码（chunked transfer encoding）方式，就可以使用首部列出位于报文拖挂（trailer）部分的首部集合 |
| Transfer-Encoding |                        告知接收端为了保证报文的可靠传输，对报文采用了什么编码方式                       |
|       Update      |                           给出了发送端可能想要"升级"使用的新版本或协议                          |
|        Via        |                             显示了报文经过的中间节点（代理、网关）                            |

###### 通用缓存首部

|       首部      |            描述           |
| :-----------: | :---------------------: |
| Cache-Control |       用于随报文传送缓存的指示      |
|     Pragma    | 另一种随报文传送指示的方式，但并不专用于缓存。 |

##### 请求首部

用于说明是谁或什么在发送请求、请求源自何处，或者客户端的喜好及能力。

###### 请求信息首部

|     首部     |            描述           |
| :--------: | :---------------------: |
|  Client-IP |    提供了运行客户端的机器的IP地址。    |
|    From    |    提供了客户端用户的E-mail地址。   |
|    Host    |   提供可接受请求的服务器的主机名和端口号   |
|   Referer  |   提供了包含当前请求URI的文档的URL   |
|  UA-Color  |   提供了与客户端显示器的显示颜色有关的信息  |
|   UA-CPU   |     提供了客户端CPU的类型或制造商    |
|   UA-Disp  |    提供了与客户端显示器能力有关的信息    |
|    UA-OS   | 提供了运行在客户端机器上的操作系统的名称及版本 |
|  UA-Pixels |      提供了客户端显示器的像素信息     |
| User-Agent |    将发起请求的应用程序名称告知服务器    |

###### Accept首部

为客户端提供了一种将其洗好和能力告知服务器的方式。这样服务器就可以根据这些信息，对要发送的内容做出更明智的决定。

|        首部       |         描述        |
| :-------------: | :---------------: |
|      Accept     |  告诉服务器能够发送哪些媒体类型  |
|  Accept-Charset |    告诉服务器发送哪些字符集   |
| Accept-Encoding |  告诉服务器能够发送哪些编码方式  |
| Accept-Language |   告诉服务器能够发送哪些语言   |
|        TE       | 告诉服务器可以使用哪些扩展传输编码 |

###### 条件请求首部

有时客户端希望为请求加上某些限制。比如，如果客户端已经有了一份文档副本，就希望只在服务器上的文档与客户端拥有的副本有区别时，才请求服务器传输文档。通过条件请求首部添加限制就可以达到目的。

|          首部         |              描述              |
| :-----------------: | :--------------------------: |
|        Expect       |      允许客户端列出某请求所要求的服务器行为     |
|       If-Match      |  如果实体标记与文档之前的实体标记相匹配，就获取这份文档 |
|  If-Modified-Since  | 除非在某个指定的日期之后资源被修改过，否则就限制这个请求 |
|    If-None-Match    | 如果提供的实体标记与当前文档的实体标记不相符，就获取文档 |
|       If-Range      |       允许对文档的某个范围进行条件请求       |
| If-Unmodified-Since |  除非在某个日期之后资源没有被修改过，否则就限制这个请求 |
|        Range        |    如果服务器支持范围请求，就请求资源的指定范围    |

###### 安全请求首部

对请求进行质询／响应认证。

|       首部      |                    描述                   |
| :-----------: | :-------------------------------------: |
| Authorization |        包含了客户端提供给服务器，以便对其自身进行认证的数据       |
|     Cookie    | 客户端用它向服务器传送一个令牌——它并不是真正的安全首部，但确实隐含了安全功能 |
|    Cookie2    |           用来说明请求端支持的cookies版本           |

###### 代理请求首部

|          首部         |                        描述                       |
| :-----------------: | :---------------------------------------------: |
|     Max-Forward     | 在通往源端服务器的路径上，将请求转发给其他代理或网关的最大次数——与TRACE方法一起使用 |
| Proxy-Authorization |     与Authorization首部相同，但这个首部实在与代理进行认证的时候后使用的    |
|   Proxy-Connection  |        与Connection首部相同，但这个首部是在与代理建立连接时使用的       |

##### 响应首部

响应首部为客户端提供了一些额外的信息, 并在将来发起更好的请求。

|      首部     |             描述             |
| :---------: | :------------------------: |
|     Age     |      （从最初创建开始）响应持续的时间      |
|    Public   |      服务器为其资源支持的请求方法列表      |
| Retry-After |     如果资源不可用的话，在此日期或时间重试    |
|    Server   |       服务器应用程序软件的名称和版本      |
|    Title    | 对HTML文档来说，就是HTML文档的源端给出的标题 |
|   Warning   |      比原因短语中更详细一些的警告报文      |

###### 协商首部

如果资源有多种表示方法——比如，如果服务器上有某文档的法语和德语译稿，HTTP/1.1可以为服务器和客户端提供对资源进行协商的能力。

|      首部      |                                   描述                                   |
| :----------: | :--------------------------------------------------------------------: |
| Accept-Range |                           对此资源来说，服务器可接受的范围类型                           |
|     Vary     | 服务器查看的其他首部的列表，可能会使响应发生变化；也就是说，这是一个首部列表，服务器会根据这些首部的内容挑选初最合适的资源版本发送给客户端。 |

###### 安全响应首部

|         首部         |                       描述                      |
| :----------------: | :-------------------------------------------: |
| Proxy-Authenticate |                 来自代理的对客户端的质询列表                |
|     Set-Cookie     | 不是真正的安全首部，但隐含有安全功能；可以在客户端设置一个令牌，以便服务器对客户端进行标识 |
|     Set-Cookie2    |                 与Set-Cookie类似                 |
|  WWW-Authenticate  |                来自服务器的对客户端的质询列表。               |

##### 实体首部

实体首部指的是用于应对实体主体部分的首部。比如，可以用实体首部来说明实体主体部分的数据类型。

|    首部    |                      描述                     |
| :------: | :-----------------------------------------: |
|   Allow  |               列出了可以对此实体执行的请求方法              |
| Location | 告知客户端实体实际上位于何处，用于将接收端定向到资源的（可能是新的）位置（URL）上去 |

###### 内容首部

内容首部提供了与实体内容相关的特定信息，说明了其类型，尺寸以及处理它所需的其他有用信息。

|        首部        |          描述          |
| :--------------: | :------------------: |
|   Content-Base   | 解析主体中的相对URL时使用的基础URL |
| Content-Encoding |     对主体执行的任意编码方式     |
| Content-Language |    理解主体时最适宜使用的自然语言   |
|  Content-length  |       主体的长度或尺寸       |
| Content-Location |       资源实际所处的位置      |
|    Content-MD5   |       主体的MD5校验和      |
|   Content-Range  |   在整个资源中此实体表示的字节范围   |
|   Content-Type   |       这个主体的对象类型      |

###### 实体缓存首部

通用的缓存首部说明了如何或什么时候进行缓存。实体的缓存首部提供了与被缓存实体有关的信息。

|       首部      |              描述             |
| :-----------: | :-------------------------: |
|      ETag     |         与此实体相关的实体标记         |
|    Expires    | 实体不再有效，要从原始的源端再次获取此实体的日期和时间 |
| Last-Modified |      这个实体最后一次被修改的日期和时间      |

#### 实体主体（Entity Body）

实体的主体是HTTP报文的负荷，就是HTTP要传输的内容。

### HTTP响应报文

![Http Response Message][http_response_message]

#### 版本（Version）

如上所述

#### 状态码（Status Code）和短语（Phrase）

##### 状态码分类

|   整体范围  |  已定义范围  |   分类  |
| :-----: | :-----: | :---: |
| 100～199 | 100～101 |   消息  |
| 200～299 | 200～206 |   成功  |
| 300～399 | 300～305 |  重定向  |
| 400～499 | 400～415 | 客户端错误 |
| 500～599 | 500～505 | 服务器错误 |

##### 常见状态码：

| 状态码 |           短语          |                         含义                        |
| :-: | :-------------------: | :-----------------------------------------------: |
| 200 |           OK          |            请求已成功，请求所希望的响应头或数据体将随此响应返回。            |
| 301 |   Moved Permanently   | 被请求的资源已永久移动到新位置，并且将来任何对此资源的引用都应该使用本响应返回的若干个URI之一。 |
| 400 |      Bad Request      |               由于包含语法错误，当前请求无法被服务器理解。              |
| 401 |      Unauthorized     |                    当前请求需要用户验证。                    |
| 403 |       Forbidden       |                 服务器已经理解请求，但是拒绝执行它。                |
| 404 |       Not Found       |             请求失败，请求所希望得到的资源未被在服务器上发现。             |
| 408 |    Request Timeout    |                       请求超时。                       |
| 500 | Internal Server Error |          服务器遇到了一个未曾预料的状况，导致了它无法完成对请求的处理。          |
| 503 |  Service Unavailable  |            由于临时的服务器维护或者过载，服务器当前无法处理请求。            |

#### 首部（Header Field）

如上所述

#### 实体主体（Entity Body）

如上所述

[computer_network_architecture]: computer_network_architecture.png

[data_packet_in_protocol_stack]: data_packet_in_protocol_stack.png

[http_request_message]: http_request_message.png

[http_response_message]: http_response_message.png

[tcp_communication]: tcp_communication.png
